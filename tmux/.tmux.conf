# Tmux Ayu Theme Configuration with Pomodoro Integration
# Add this to your ~/.tmux.conf file
set -sg escape-time 1

# Ayu Dark Theme Colors
ayu_bg="#0f1419"
ayu_fg="#bfbdb6"
ayu_selection="#273747"
ayu_comment="#5c6773"
ayu_red="#f07178"
ayu_orange="#ff8f40"
ayu_yellow="#ffb454"
ayu_green="#b8cc52"
ayu_cyan="#95e6cb"
ayu_blue="#59c2ff"
ayu_purple="#d2a6ff"
ayu_pink="#f29668"

# Basic settings
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color*:Tc"

# Status bar configuration
set -g status-position top
set -g status-justify left
set -g status-style bg=default
# set -g status-style "bg=$ayu_bg,fg=$ayu_fg"
set -g status-left-length 99
set -g status-right-length 99
# set -g center-interval 5  # Refresh status bar every second
set -g focus-events on


# Toggle status bar visibility
bind-key b set-option -g status \
    #{?#{==:#{status},on},off,on}

# Window status (inactive)
setw -g window-status-style "bg=$ayu_selection,fg=$ayu_fg"
setw -g window-status-format " #I #W "

# Active window with checklist
setw -g window-status-current-style "bg=$ayu_blue,fg=$ayu_bg,bold"
setw -g window-status-current-format " #I #W âœ… "

# Pane borders
set -g pane-border-style "fg=$ayu_comment"

# Active pane border with checklist
set -g pane-active-border-style "fg=$ayu_blue"

# Message style
set -g message-style "bg=$ayu_orange,fg=$ayu_bg,bold"
set -g message-command-style "bg=$ayu_yellow,fg=$ayu_bg,bold"

# Status left (session info with prefix indicator)
set -g status-left "#{?client_prefix,#[bg=$ayu_orange]#[fg=$ayu_bg]#[bold] #S #[bg=$ayu_bg]#[fg=$ayu_orange],#[bg=$ayu_green]#[fg=$ayu_bg]#[bold] #S #[bg=$ayu_bg]#[fg=$ayu_green]}"

# set -g status-center "#[fg=$ayu_yellow]#(~/.local/bin/nowplaying)"

# Status right (pomodoro, date/time)
set -g status-right "#[fg=$ayu_cyan]%H:%M #[fg=$ayu_purple]%d-%b-%Y"

# Copy mode colors
setw -g mode-style "bg=$ayu_yellow,fg=$ayu_bg"

# Clock mode
setw -g clock-mode-colour "$ayu_blue"

# Alternative Ayu Light Theme (uncomment to use)
# ayu_bg="#fafafa"
# ayu_fg="#5c6773"
# ayu_selection="#f0f0f0"
# ayu_comment="#abb0b6"
# ayu_red="#f07178"
# ayu_orange="#fa8d3e"
# ayu_yellow="#f2cc60"
# ayu_green="#86b300"
# ayu_cyan="#4cbf99"
# ayu_blue="#36a3d9"
# ayu_purple="#a37acc"
# ayu_pink="#f29668"

# Custom key bindings with theme colors
bind-key r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Pomodoro key bindings (using helper script)
# bind-key P display-message "Starting Pomodoro..." \; run-shell -b "~/.local/bin/pomodoro-tmux start"
# bind-key B display-message "Starting Break..." \; run-shell -b "~/.local/bin/pomodoro-tmux break"
# bind-key O display-message "Stopping Pomodoro..." \; run-shell -b "~/.local/bin/pomodoro-tmux stop"

# Additional visual enhancements
set -g visual-activity off
setw -g monitor-activity off

# Renumber windows when one is closed
set -g renumber-windows on

# Enable mouse support
set -g mouse on

# Let vim-tmux-navigator handle split movement
unbind -n C-h
unbind -n C-j
unbind -n C-k
unbind -n C-l

# vim-tmux-navigator integration
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
bind Tab last-window
# bind -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"


# Open new pane in current directory
bind '"' split-window -v -c "#{pane_current_path}"
bind '%' split-window -h -c "#{pane_current_path}"

# Open new window in current directory
bind c new-window -c "#{pane_current_path}"

# Auto-rename window to current directory name
set-option -g automatic-rename on
set-option -g automatic-rename-format "#{b:pane_current_path##*/}"

# Enable vi key bindings in copy and command mode
set -g mode-keys vi

# Move cursor in copy mode using hjkl
bind -T copy-mode-vi h send-keys -X cursor-left
bind -T copy-mode-vi j send-keys -X cursor-down
bind -T copy-mode-vi k send-keys -X cursor-up
bind -T copy-mode-vi l send-keys -X cursor-right

# Also allow searching with /
bind -T copy-mode-vi / command-prompt -p "Search" "send -X search-forward '%%'"
bind -T copy-mode-vi ? command-prompt -p "Search Backward" "send -X search-backward '%%'"

# Quit copy mode with 'q' or <Esc>
bind -T copy-mode-vi q send-keys -X cancel
bind -T copy-mode-vi Escape send-keys -X cancel

# Make 'v' start characterwise selection in copy mode
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Resize pane with prefix + h/j/k/l
bind -r h resize-pane -L 5
bind -r l resize-pane -R 5
bind -r k resize-pane -U 2
bind -r j resize-pane -D 2

# open fzf session switcher
bind-key s run-shell "~/.tmux/scripts/fzf-switch-session.sh"

# bind-key u run-shell "~/.tmux/scripts/open-commands-server.sh"

# open opencode
# bind-key o split-window -h -l 40% -c "#{pane_current_path}" "opencode"

bind-key o run-shell ' \
  client_cols=$(tmux display -p "#{client_width}"); \
  pane_cols=$(tmux display -p "#{pane_width}"); \
  current_dir=$(tmux display -p "#{pane_current_path}"); \
  base=$(basename "$current_dir"); \
  if [ "$client_cols" -le 200 ]; then \
    tmux new-window -n "${base}-opencode" -c "$current_dir" "opencode"; \
  else \
    tmux split-window -h -l 40% -c "$current_dir" "opencode"; \
  fi \
'

bind-key q new-window -n "database" "sq"

# open crush
# bind-key u split-window -h -l 40% -c "#{pane_current_path}" "crush"

bind-key u run-shell ' \
  client_cols=$(tmux display -p "#{client_width}"); \
  pane_cols=$(tmux display -p "#{pane_width}"); \
  current_dir=$(tmux display -p "#{pane_current_path}"); \
  base=$(basename "$current_dir"); \
  if [ "$client_cols" -le 200 ]; then \
    tmux new-window -n "${base}-opencode" -c "$current_dir" "crush"; \
  else \
    tmux split-window -h -l 40% -c "$current_dir" "crush"; \
  fi \
'


# tpm
run -b '~/.tmux/plugins/tpm/tpm'

